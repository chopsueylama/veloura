<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Veloura$ — Gem Collection</title>

  <link rel="stylesheet" href="styles.css?v=glb-url" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><text y='50%' x='50%' dominant-baseline='middle' text-anchor='middle' font-size='48'>$</text></svg>">
</head>

<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="index.html">Veloura<span>$</span></a>
      <nav class="nav">
        <a href="index.html#collection">Collection</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="cart.html">Cart <span id="cartBadge">0</span></a>
      </nav>
    </div>
  </header>

  <main class="container section">
    <div class="section-head">
      <h1>Gemstone Collection</h1>
      <p class="muted">Original renders, real specs. Click any stone to view details and gallery.</p>
    </div>

    <div id="collection" class="grid">
      <!-- keep your real product cards here -->
      <article class="card">
        <a href="#">
          <div class="card-media"><img src="/veloura/assets/ceylon-blue-sapphire/set1.png" alt=""></div>
        </a>
        <h3>Ceylon Blue Sapphire — Cushion Cut</h3>
        <p class="muted">Blue Sapphire · Cushion · 2.45 ct</p>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>$4850</strong><button class="btn">Add</button>
        </div>
      </article>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <strong>Veloura<span>$</span></strong>
      <span class="muted">© <span id="year"></span></span>
      <div style="margin-top:12px">
        <label class="motion-toggle"><input id="motionToggle" type="checkbox" /> Reduce motion</label>
      </div>
    </div>
  </footer>

  <!-- WebGL canvas behind everything -->
  <canvas id="diamondScene" aria-hidden="true"></canvas>

  <!-- Small site JS (year + reduce motion) -->
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    (function(){
      const KEY='veloura_rm';
      const apply = v => document.body.classList.toggle('motion-muted', !!v);
      try{ apply(localStorage.getItem(KEY)==='1'); }catch{}
      const cb=document.getElementById('motionToggle');
      if(cb){ cb.checked=document.body.classList.contains('motion-muted'); cb.onchange=()=>{ try{localStorage.setItem(KEY, cb.checked?'1':'0');}catch{} apply(cb.checked); location.reload(); }; }
    })();
  </script>

  <!-- Three.js: URL imports ONLY (no "import 'three'") -->
  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
    import { GLTFLoader } from 'https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js';

    // stop if reduced motion
    if (document.body.classList.contains('motion-muted') ||
        window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      // do nothing
    } else {
      const canvas = document.getElementById('diamondScene');

      // Renderer
      const renderer = new THREE.WebGLRenderer({ canvas, alpha:true, antialias:true });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio||1, 2));
      renderer.setSize(innerWidth, innerHeight);
      renderer.outputColorSpace = THREE.SRGBColorSpace;
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      renderer.toneMappingExposure = 1.05;
      renderer.setClearColor(0x000000, 0);

      // Scene & camera
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 100);
      camera.position.set(0, 0, 6);

      // Lights
      scene.add(new THREE.AmbientLight(0xffffff, 0.55));
      const key  = new THREE.DirectionalLight(0xffffff, 1.0); key.position.set(-2, 3, 5);
      const fill = new THREE.DirectionalLight(0xf0e0c8, 0.6); fill.position.set( 3,-2, 2);
      const rim  = new THREE.DirectionalLight(0xcce5ff, 0.5); rim.position.set(-3, 1,-3);
      scene.add(key, fill, rim);

      // Load your models
      const loader = new GLTFLoader();
      const paths = [
        'assets/models/diamond.glb',
        'assets/models/ring.glb',
        'assets/models/the_ring_1_carat.glb'
      ];

      const group = new THREE.Group();
      scene.add(group);

      // Arrange left–center–right
      paths.forEach((p, i) => {
        loader.load(p, (gltf) => {
          const m = gltf.scene;
          const s = 1.1; m.scale.set(s,s,s);
          m.position.set((i - 1) * 1.9, -0.35, 0);
          m.traverse(o => {
            if (o.isMesh && o.material && 'roughness' in o.material) {
              o.material.roughness = Math.min(0.15, o.material.roughness ?? 0.2);
              o.material.metalness = Math.max(0.0, o.material.metalness ?? 0.0);
            }
          });
          group.add(m);
        }, undefined, err => console.error('GLB load error:', p, err));
      });

      // Parallax
      let tRX=0, tRY=0;
      addEventListener('mousemove', e=>{
        const nx=(e.clientX/innerWidth)*2-1, ny=(e.clientY/innerHeight)*2-1;
        tRY = nx*0.15; tRX = -ny*0.10;
      }, {passive:true});

      function animate(){
        requestAnimationFrame(animate);
        group.rotation.y += 0.004;
        group.rotation.x += 0.0015;
        group.rotation.y += (tRY - group.rotation.y) * 0.04;
        group.rotation.x += (tRX - group.rotation.x) * 0.04;
        renderer.render(scene, camera);
      }
      animate();

      addEventListener('resize', ()=>{
        renderer.setSize(innerWidth, innerHeight);
        camera.aspect = innerWidth/innerHeight;
        camera.updateProjectionMatrix();
      });
    }
  </script>
</body>
</html>